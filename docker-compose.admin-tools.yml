# LogiX 数据库管理工具
# Database Management Tools for LogiX
#
# 使用方法:
# Usage:
#   # 方法一: 先启动主服务, 再启动管理工具
#   docker-compose -f docker-compose.timescaledb.prod.yml --env-file .env up -d postgres redis
#   docker-compose -f docker-compose.admin-tools.yml --env-file .env up -d
#
#   # 方法二: 同时启动 (使用多个 -f 参数)
#   docker-compose -f docker-compose.timescaledb.prod.yml -f docker-compose.admin-tools.yml --env-file .env up -d postgres redis adminer pgadmin
#
# 访问地址:
# Access URLs:
#   Adminer:  http://localhost:8080 (账号: adminer, 轻量级)
#   pgAdmin:  http://localhost:5050 (需要首次设置, 功能完整)

services:
  # Adminer - 轻量级数据库管理工具
  # Adminer - Lightweight Database Management Tool
  adminer:
    image: adminer:latest
    container_name: logix-adminer
    restart: unless-stopped
    environment:
      ADMINER_DEFAULT_SERVER: postgres
      ADMINER_DEFAULT_DRIVER: pgsql
      ADMINER_DESIGN: nette
    ports:
      - "8080:8080"
    networks:
      - logix-prod-network  # 使用主服务的网络
    depends_on:
      - postgres  # Dependency on postgres from main compose file
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M

  # pgAdmin4 - PostgreSQL 官方管理工具
  # pgAdmin4 - Official PostgreSQL Management Tool
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: logix-pgadmin
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL:-admin@logix.com}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD:-LogiX@2024}
      PGADMIN_CONFIG_SERVER_MODE: 'False'
      PGADMIN_LISTEN_PORT: 80
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    ports:
      - "5050:80"
    networks:
      - logix-prod-network  # 使用主服务的网络
    depends_on:
      - postgres  # Dependency on postgres from main compose file
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M

  # 注意: 此配置使用主服务的网络 (logix-prod-network)
  # Note: This config uses the main service network (logix-prod-network)
  # 必须先启动主服务, 或者同时启动
  # Must start main services first, or start together

networks:
  logix-prod-network:
    name: logix-prod-network
    driver: bridge

volumes:
  pgadmin_data:
    driver: local

